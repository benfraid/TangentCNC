<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TangentCNC - Toolpath Editor</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üîß TangentCNC</h1>
            <p class="subtitle">C-axis Orientation Tool for CNC Toolpaths <span style="font-size: 0.8em; color: #7f8c8d;">v0.1.9</span></p>
        </header>

        <!-- Workflow Step 1: Input & Edit -->
        <section class="workflow-section">
            <div class="section-header">
                <span class="step-number">1</span>
                <h2>Input & Edit Toolpath</h2>
            </div>
            <div class="section-content">
                <div class="input-methods">
                    <button onclick="document.getElementById('gcodeFileInput').click()" class="btn btn-primary btn-large">
                        üì§ Import G-code File
                    </button>
                    <input id="gcodeFileInput" type="file" accept=".nc,.gcode,.txt" style="display:none">
                    <span class="method-separator">or</span>
                    <button onclick="toggleDrawMode()" class="btn btn-secondary btn-large" id="drawModeBtn">
                        ‚úèÔ∏è Draw Path Manually
                    </button>
                </div>
                <div id="drawModePanel" class="draw-mode-panel" style="display:none;">
                    <div class="editor-controls-inline">
                        <button onclick="clearAll()" class="btn btn-danger btn-sm">üóëÔ∏è Clear</button>
                        <label>
                            <input type="checkbox" id="deleteMode" onchange="setDeleteMode(this.checked)">
                            Delete Mode
                        </label>
                        <label>
                            Resolution:
                            <input type="range" id="resolutionSlider" min="10" max="200" value="100" 
                                   oninput="updateResolution(this.value)" style="width: 100px;">
                            <span id="resolutionValue">100</span>
                        </label>
                        <span class="info-text">
                            <strong id="pointCount">0</strong> points | Click: Add/Move | Right-click: Delete
                        </span>
                    </div>
                </div>
                
                <!-- Editor Canvas -->
                <div class="canvas-container" id="editorCanvasContainer" style="display:none;">
                    <h3>Path Editor</h3>
                    <canvas id="canvas" width="900" height="600"></canvas>
                </div>
            </div>
        </section>

        <!-- Workflow Step 2: Configure -->
        <section class="workflow-section">
            <div class="section-header">
                <span class="step-number">2</span>
                <h2>Configure Parameters</h2>
            </div>
            <div class="section-content">
                <details class="settings-panel" open>
                    <summary>‚öôÔ∏è Machining & C-axis Settings</summary>
                    <div class="settings-grid">
                        <div class="setting-row">
                            <label>Unit:</label>
                            <select id="unitSelect" onchange="updateSettings()">
                                <option value="mm">Millimeters (mm)</option>
                                <option value="inch">Inches (inch)</option>
                            </select>
                        </div>
                        <div class="setting-row">
                            <label>Scale Factor:</label>
                            <input type="number" id="scaleFactor" value="0.1" step="0.01" min="0.001" onchange="updateSettings()">
                            <span class="hint">Canvas pixels ‚Üí real units</span>
                        </div>
                        <div class="setting-row">
                            <label>Safe Height (Z):</label>
                            <input type="number" id="safeHeight" value="5.0" step="0.5" onchange="updateSettings()">
                            <span class="unit-label" id="safeHeightUnit">mm</span>
                        </div>
                        <div class="setting-row">
                            <label>Cut Depth (Z):</label>
                            <input type="number" id="cutDepth" value="-1.0" step="0.1" onchange="updateSettings()">
                            <span class="unit-label" id="cutDepthUnit">mm</span>
                        </div>
                        <div class="setting-row">
                            <label>Feed Rate (F):</label>
                            <input type="number" id="feedRate" value="300" step="10" min="1" onchange="updateSettings()">
                            <span class="unit-label" id="feedRateUnit">mm/min</span>
                        </div>
                        <div class="setting-row">
                            <label>Rapid Rate (G0):</label>
                            <input type="number" id="rapidRate" value="1000" step="50" min="1" onchange="updateSettings()">
                            <span class="unit-label" id="rapidRateUnit">mm/min</span>
                        </div>
                        <div class="setting-row">
                            <label>C-axis Angle Mode:</label>
                            <select id="angleMode" onchange="updateSettings()">
                                <option value="0-360">0¬∞ to 360¬∞</option>
                                <option value="-180-180" selected>-180¬∞ to 180¬∞</option>
                            </select>
                        </div>
                        <div class="setting-row">
                            <label>C-axis Offset:</label>
                            <input type="number" id="angleOffset" value="0" step="1" onchange="updateSettings()">
                            <span class="hint">degrees</span>
                        </div>
                        <div class="setting-row">
                            <label>Use Shortest Path:</label>
                            <input type="checkbox" id="shortestPath" checked onchange="updateSettings()">
                            <span class="hint">Minimize rotation</span>
                        </div>
                        <div class="setting-row">
                            <label>Tool Tip Offset X:</label>
                            <input type="number" id="toolOffsetX" value="0" step="0.5" onchange="updateSettings()">
                            <span class="unit-label" id="toolOffsetXUnit">mm</span>
                        </div>
                        <div class="setting-row">
                            <label>Tool Tip Offset Y:</label>
                            <input type="number" id="toolOffsetY" value="0" step="0.5" onchange="updateSettings()">
                            <span class="unit-label" id="toolOffsetYUnit">mm</span>
                        </div>
                    </div>
                </details>
            </div>
        </section>

        <!-- Workflow Step 3: Generate & Preview -->
        <section class="workflow-section">
            <div class="section-header">
                <span class="step-number">3</span>
                <h2>Generate & Preview</h2>
            </div>
            <div class="section-content">
                    <!-- Generation Controls -->
                    <div class="generation-controls">
                        <div class="gen-option">
                            <h3>Base G-code (XYZ only)</h3>
                            <button onclick="generateGCodePreview()" class="btn btn-primary">‚öôÔ∏è Generate</button>
                        </div>
                        <div class="gen-option">
                            <h3>Oriented G-code (+ C-axis)</h3>
                            <p class="gen-hint">Adds C-axis orientation to Base G-code</p>
                            <button onclick="generateOrientedGCodePreview()" class="btn btn-primary">üß≠ Add Orientation</button>
                        </div>
                    </div>
                
                    <!-- Preview Canvas -->
                    <div class="canvas-container">
                        <h3>G-code Preview</h3>
                        <canvas id="previewCanvas" width="900" height="600"></canvas>
                    </div>
                
                    <!-- Preview Controls -->
                    <div class="preview-section">
                        <h3>Preview Animation</h3>
                        <!-- Row 1: Buttons, Mode, Show Direction -->
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px; flex-wrap: wrap;">
                            <button id="btnPlayPause" onclick="togglePlay()" class="btn btn-primary">‚ñ∂</button>
                            <button onclick="resetPreview()" class="btn btn-secondary">‚èÆ</button>
                            <div class="preview-mode-inline" style="display: flex; align-items: center; gap: 5px;">
                                <span class="inline-label">Mode:</span>
                                <label>
                                    <input type="radio" name="previewMode" value="base" checked onchange="setPreviewMode('base')">
                                    Base
                                </label>
                                <label>
                                    <input type="radio" name="previewMode" value="oriented" onchange="setPreviewMode('oriented')">
                                    Oriented
                                </label>
                            </div>
                            <label>
                                <input type="checkbox" id="showDirection" checked onchange="toggleDirection(this.checked)">
                                Show direction
                            </label>
                        </div>
                        <!-- Row 2: Speed -->
                        <div style="margin-bottom: 10px;">
                            <label>
                                Speed:
                                <input type="range" id="previewSpeed" min="10" max="800" value="200" 
                                       oninput="updatePreviewSpeed(this.value)" style="width: 200px;">
                                <span id="previewSpeedValue">200 px/s</span>
                            </label>
                        </div>
                        <!-- Row 3: Progress -->
                        <div class="progress-control">
                            <label style="display: block;">
                                Progress:
                                <input type="range" id="previewProgress" min="0" max="100" value="0" step="0.1" style="width: 100%">
                                <span id="previewProgressValue">0%</span>
                            </label>
                        </div>
                    </div>

                <!-- G-code Comparison -->
                <details id="gcodePreviewPanel">
                    <summary>üìÑ View G-code Comparison</summary>
                    <div class="gcode-compare">
                        <div class="gcode-col">
                            <div class="gcode-col-header">Base (XYZ)</div>
                            <textarea id="gcodeOutput" spellcheck="false" placeholder="Generate base G-code..."></textarea>
                        </div>
                        <div class="gcode-col">
                            <div class="gcode-col-header">Oriented (XYZ + C)</div>
                            <textarea id="gcodeOutputOriented" spellcheck="false" placeholder="Generate oriented G-code..."></textarea>
                        </div>
                    </div>
                </details>
            </div>
        </section>

        <!-- Workflow Step 4: Download -->
        <section class="workflow-section">
            <div class="section-header">
                <span class="step-number">4</span>
                <h2>Download Output</h2>
            </div>
            <div class="section-content">
                <div class="download-options">
                    <button onclick="downloadGCode()" class="btn btn-success btn-large">
                        ‚¨áÔ∏è Download Base G-code (.nc)
                    </button>
                    <button onclick="downloadOrientedGCode()" class="btn btn-success btn-large">
                        ‚¨áÔ∏è Download Oriented G-code (.nc)
                    </button>
                </div>
            </div>
        </section>

        <footer class="app-footer">
            <p>TangentCNC v1.0.0 | <a href="https://github.com/benfraid/TangentCNC" target="_blank">GitHub</a></p>
        </footer>
    </div>

    <script src="script.js"></script>
</body>
</html>
